{"version":3,"file":"bullet-train.esm.js","sources":["../../javascript/concerns/sortable.js","../../javascript/concerns/reassignable.js"],"sourcesContent":["require(\"dragula/dist/dragula.min.css\")\n\nimport dragula from 'dragula';\n\nfunction saveSortOrder($container) {\n  var idsInOrder = $container.find('> *').map(function(index,element) { return parseInt($(element).attr('data-id')); }).toArray();\n  $.post($container.attr('data-reorder'), {ids_in_order: idsInOrder}, function() {\n    if ($container.closest('.opened-modally').length) {\n      refreshModalBase();\n    }\n  });\n}\n\nfunction enableSortable($scope) {\n  setTimeout(function() {\n    var selector = '[data-reorder]';\n    var $reorderable = $scope.find(selector).addBack(selector);\n    console.log(\"enabling sort on array of \" + $reorderable.length);\n\n    $reorderable.each(function (index, container) {\n\n      var $container = $(container);\n\n      // enable drag-and-drop reordering.\n      var dragulaObj = dragula([container], {\n        moves: function(el, container, handle) {\n          var $handles = $(el).find('.reorder-handle')\n          if ($handles.length) {\n            return !!$(handle).closest('.reorder-handle').length\n          } else {\n            if (!$(handle).closest('.undraggable').length) {\n              return $(handle).closest('[data-reorder]')[0] == container;\n            } else {\n              return false;\n            }\n          }\n        },\n        accepts: function (el, target, source, sibling) {\n          if ($(sibling).hasClass('undraggable') && $(sibling).prev().hasClass('undraggable')) {\n            return false;\n          } else {\n            return true;\n          }\n        },\n      }).on('drop', function (el) {\n\n        // save order here.\n        saveSortOrder($container);\n\n      }).on('over', function (el, container) {\n\n        // deselect any text fields, or else things go slow!\n        $(document.activeElement).blur();\n\n      });\n\n    });\n  }, 500);\n}\n\n$(document).on('turbo:load', function() {\n  console.log(\"游꼴 Sortable: Enabling on <body> after a Turbo load.\")\n  enableSortable($('body'));\n})\n\n$(document).on('sprinkles:update', function(event) {\n  console.log(\"游꼴 Sortable: Enabling on the following element after a Sprinkles content update:\")\n  console.log(event.target);\n  enableSortable($(event.target));\n})\n","require(\"dragula/dist/dragula.min.css\")\n\nimport dragula from 'dragula';\n\nfunction saveAssignments($container) {\n  var parents = $container.find('[data-reassignment-parent]').map(function(index,element) { return parseInt($(element).attr('data-id')); }).toArray();\n  var assignmentsById = {}\n  $.each(parents, function(_, parentId) {\n    assignmentsById[parentId] = $container.find(\"[data-reassignment-parent]\").filter(\"[data-id='\" + parentId + \"']\").find(\"[data-reassignable]\").map(function(index,element) { return parseInt($(element).attr('data-id')); }).toArray();\n  });\n  $.post($container.attr('data-reassign'), {assignments_by_id: assignmentsById, dispatched_at: new Date().getTime()});\n}\n\nfunction enableReassignable($scope) {\n  setTimeout(function() {\n    var selector = '[data-reassign]';\n    var $reassignable = $scope.find(selector).addBack(selector);\n\n    $reassignable.each(function (_, container) {\n\n      console.log(\"游꼴 Reassignable 游눫 Found the following container:\")\n      console.log(container);\n\n      var $container = $(container);\n      var dragulaObj = dragula($container.find('[data-reassignment-parent]').toArray(), {\n        moves: function(el, container, handle) {\n          if ($(handle).hasClass('undraggable') || ($(handle).closest('.undraggable').length > 0)) {\n            return false;\n          }\n          return !!$(handle).closest('[data-reassignable]').length;\n        },\n        accepts: function (el, target, source, sibling) {\n          if ($(sibling).hasClass('undraggable') && $(sibling).prev().hasClass('undraggable')) {\n            return false;\n          } else {\n            return true;\n          }\n        },\n      }).on('drag', function (el) {\n        $reassignable.addClass('show-reassignable-targets')\n      }).on('drop', function (el) {\n        $reassignable.removeClass('show-reassignable-targets')\n        saveAssignments($container);\n      }).on('cancel', function (el) {\n        $reassignable.removeClass('show-reassignable-targets')\n        saveAssignments($container);\n      }).on('over', function (el, container) {\n        $(document.activeElement).blur();\n      });\n    });\n  }, 500);\n}\n\n$(document).on('turbo:load', function() {\n  console.log(\"游꼴 Reassignable: Enabling on <body> after a Turbo load.\")\n  enableReassignable($('body'));\n})\n\n$(document).on('sprinkles:update', function(event) {\n  console.log(\"游꼴 Reassignable: Enabling on the following element after a Sprinkles content update:\")\n  console.log(event.target);\n  enableReassignable($(event.target));\n})\n"],"names":["enableSortable","$scope","setTimeout","selector","$reorderable","find","addBack","console","log","length","each","index","container","$container","$","dragula","moves","el","handle","closest","accepts","target","source","sibling","hasClass","prev","on","idsInOrder","map","element","parseInt","attr","toArray","post","ids_in_order","refreshModalBase","saveSortOrder","document","activeElement","blur","saveAssignments","parents","assignmentsById","_","parentId","filter","assignments_by_id","dispatched_at","Date","getTime","enableReassignable","$reassignable","addClass","removeClass","require","event"],"mappings":"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"}